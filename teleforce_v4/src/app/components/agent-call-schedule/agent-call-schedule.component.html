<div class="warap-height pt-4">
    <!-- Begin Page Content -->
    <div class="container-fluid">

        <!-- Page Heading -->
        <h1 class="h3 mb-2 text-gray-800">Call Schedule</h1>
        
        <!--heading filter form-->
        <form [formGroup]="searchform" (ngSubmit)="searchData()">
            <div class="row">
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Caller Number</mat-label>
                        <input matInput placeholder="Caller Number" formControlName="callerno">
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Start Date</mat-label>
                        <input matInput placeholder="Start Date" [matDatepicker]="startpicker" formControlName="startdate">
                        <mat-datepicker-toggle matSuffix [for]="startpicker"></mat-datepicker-toggle>
                        <mat-datepicker #startpicker tpicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>End Date</mat-label>
                        <input matInput placeholder="End Date" [matDatepicker]="endpicker" formControlName="enddate">
                        <mat-datepicker-toggle matSuffix [for]="endpicker"></mat-datepicker-toggle>
                        <mat-datepicker #endpicker tpicker></mat-datepicker>
                    </mat-form-field> 
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <button  class="mt-2" mat-raised-button type="submit">Search</button>
                    <button  class="ml-2" title="refresh" (click)="resetform()" mat-mini-fab color="warn" aria-label="Example icon button with a plus one icon">
                        <span class="material-icons">refresh</span>
                    </button>
                </div>
            </div>
        </form>
      
        <!-- Table List -->
        <div class="card shadow mt-2 mb-1">
            <!--Progress Bar-->
            <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>      
            <div class="card-body">
                <!--Excel Btn-->
                <div fxLayout fxLayoutAlign="center center" class="mt-2" *ngIf="isCSV">
                    <button mat-raised-button color="primary"
                        (click)="exporter2.exportTable('csv', {fileName:'schedule-lead', sheet:'sheet_name'})">
                        CSV
                    </button>
                </div>
                <!--Table Content-->
                <div class="table-responsive mt-3">
                    <table mat-table [dataSource]="scheduledataSource" matSort class="mat-elevation-z8" matTableExporter #exporter2="matTableExporter">
                    
                        <!-- Position Column -->
                        <ng-container matColumnDef="id">
                            <th mat-header-cell *matHeaderCellDef> Sr. No. </th>
                            <td mat-cell *matCellDef="let row;let i = index;" data-label="id">
                                {{i+1+(schedulepaginator.pageIndex * schedulepaginator.pageSize)}}
                            </td>
                        </ng-container>
                    
                        <!-- CallStartTime Column -->
                        <ng-container matColumnDef="calltime">
                            <th mat-header-cell *matHeaderCellDef  mat-sort-header>  Call Time </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.CallStartTime | date: 'dd-MM-yyyy H:mm:s':timezone}}
                            </td>
                        </ng-container>
                    
                        <!-- CallerName Column -->
                        <ng-container matColumnDef="callername">
                            <th mat-header-cell *matHeaderCellDef> Caller Name </th>
                            <td mat-cell *matCellDef="let row"> 
                                {{row.CallerName}}
                            </td>
                        </ng-container>
                    
                        <!-- CallerNumber Column -->
                        <ng-container matColumnDef="callerno">
                            <th mat-header-cell *matHeaderCellDef> Caller Number </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.CallerNumber}}
                            </td>
                        </ng-container>

                        <!-- CallTalkTime Column -->
                        <ng-container matColumnDef="duration">
                            <th mat-header-cell *matHeaderCellDef> Duration </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.CallTalkTime}}
                            </td>
                        </ng-container>

                        <!-- CallType Column -->
                        <ng-container matColumnDef="type">
                            <th mat-header-cell *matHeaderCellDef> Call Type </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.CallType | titlecase}}
                            </td>
                        </ng-container>

                        <!-- CallStatus Column -->
                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef> Status </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.CallStatus}}
                            </td>
                        </ng-container>

                        <!-- AgentName Column -->
                        <ng-container matColumnDef="agent">
                            <th mat-header-cell *matHeaderCellDef> Agent </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.AgentName}}
                            </td>
                        </ng-container>

                        <!-- feedback Column -->
                        <ng-container matColumnDef="feedback">
                            <th mat-header-cell *matHeaderCellDef> Feedback </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.feedback | titlecase}}
                            </td>
                        </ng-container>

                        <!-- scheduledate Column -->
                        <ng-container matColumnDef="scheduledate">
                            <th mat-header-cell *matHeaderCellDef> Schedule Date </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.scheduledate | date:'dd-MM-yyyy HH:mm:ss':timezone}}
                            </td>
                        </ng-container>

                        <!-- Note Column -->
                        <ng-container matColumnDef="note">
                            <th mat-header-cell *matHeaderCellDef> Note </th>
                            <td mat-cell *matCellDef="let row">
                                {{row.note | titlecase}}
                            </td>
                        </ng-container>                                             

                        <!-- CallStatus Column -->
                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef> Action </th>
                            <td mat-cell *matCellDef="let row">
                                <button mat-icon-button color="primary">
                                    <span (click)="clicktocall(row.AgentID,row.callernumber)" title="Call">
                                        <mat-icon>call</mat-icon>
                                    </span>
                                </button>
                                <button mat-icon-button style="color:green;" *ngIf="row.is_schedule">
                                    <span (click)="schedulecall(row.id)" title="Call Already Schedule">
                                        <mat-icon>contact_phone</mat-icon>
                                    </span>
                                </button>
                                <button mat-icon-button color="warn" *ngIf="!row.is_schedule">
                                    <span (click)="schedulecall(row.id)" title="Schedule Call">
                                        <mat-icon>contact_phone</mat-icon>
                                    </span>
                                </button>
                                <button mat-icon-button color="primary"*ngIf="access==1">
                                    <span (click)="openrecording(row.id,row.RecPath)" title="Listen Audio">
                                        <mat-icon>headset</mat-icon>
                                      </span>
                                </button>
                                </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="scheduleColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: scheduleColumns;"></tr>
                    </table>
                </div>
                <mat-paginator #schedulepaginator [length]="scheduleLength" [pageSize]="50"
                [pageSizeOptions]="[50,100,500]"></mat-paginator>
            </div>
        </div>

    </div>
    <!-- /.container-fluid -->
</div>   