<div class="warap-height pt-4">
    <!-- Begin Page Content -->
    <div class="container-fluid">

        <!-- Page Heading -->
        <h1 class="h3 mb-2 text-gray-800">Call History</h1>
        <form [formGroup]="searchform" (ngSubmit)="searchData()">
            <div class="row">                
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Start Date</mat-label>
                        <input matInput placeholder="Start Date" [matDatepicker]="startpicker" formControlName="startdate">
                        <mat-datepicker-toggle matSuffix [for]="startpicker"></mat-datepicker-toggle>
                        <mat-datepicker #startpicker tpicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>End Date</mat-label>
                        <input matInput placeholder="End Date" [matDatepicker]="endpicker" formControlName="enddate">
                        <mat-datepicker-toggle matSuffix [for]="endpicker"></mat-datepicker-toggle>
                        <mat-datepicker #endpicker tpicker></mat-datepicker>
                    </mat-form-field> 
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Caller Name</mat-label>
                        <input matInput placeholder="Caller Name" formControlName="name">
                    </mat-form-field>
                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <mat-form-field appearance="outline">
                        <mat-label>Caller Number</mat-label>
                        <input matInput placeholder="Caller Number" formControlName="mobile">
                    </mat-form-field>
                </div>
                <div>
                   <mat-form-field appearance="outline">
                        <mat-label>Feedback</mat-label>
                       
                            <input matInput placeholder="Feedback" formControlName="feedback">
                                         
                    </mat-form-field>

                </div>
                <div class="col-12 col-md-3 col-lg-2 col-xl-2 col-sm-6">
                    <button class="mt-2" mat-raised-button type="submit">Search</button>
                    <button class="ml-2" title="refresh" (click)="resetform()" mat-mini-fab color="warn" aria-label="Example icon button with a plus one icon">
                        <span class="material-icons">refresh</span>
                    </button>
                </div>
            </div>
        </form>

        <!-- Page Inner -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <mat-tab-group (selectedTabChange)="onTabClick($event)">
                    <!-- History of Missed--> 
                    <mat-tab label="Missed">
                        <!--Process Bar-->
                        <mat-progress-bar mode="misseddataSource" *ngIf="isLoading2"></mat-progress-bar>
                        <!--History Table-->
                        <div class="table-responsive mt-3">
                            <table mat-table [dataSource]="misseddataSource" matSort class="mat-elevation-z8">
                            
                                <!-- Position Column -->
                                <ng-container matColumnDef="id">
                                    <th mat-header-cell *matHeaderCellDef> Sr. No. </th>
                                    <td mat-cell *matCellDef="let row;let i = index;" data-label="id">
                                        {{i+1+(missedpaginator.pageIndex * missedpaginator.pageSize)}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallStartTime Column -->
                                <ng-container matColumnDef="CallStartTime">
                                    <th mat-header-cell *matHeaderCellDef>  Call Time </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.callstarttime | date: 'dd-MM-yyyy H:mm:s':timezone}}
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="DID">
                                    <th mat-header-cell *matHeaderCellDef>  DID </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.did}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerName Column -->
                                <ng-container matColumnDef="CallerName">
                                    <th mat-header-cell *matHeaderCellDef> Name </th>
                                    <td mat-cell *matCellDef="let row"> 
                                        {{row.callername}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerNumber Column -->
                                <ng-container matColumnDef="CallerNumber">
                                    <th mat-header-cell *matHeaderCellDef> Number </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.caller_number}}
                                    </td>
                                </ng-container>

                                <!-- CallTalkTime Column -->
                                <ng-container matColumnDef="CallTalkTime">
                                    <th mat-header-cell *matHeaderCellDef> Duration </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.calltalktime}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="CallStatus">
                                    <th mat-header-cell *matHeaderCellDef> Status </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.callstatus}}
                                    </td>
                                </ng-container>
                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="callback">
                                    <th mat-header-cell *matHeaderCellDef> Callback </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.callbackcount>0?'Yes':'No'}}
                                    </td>
                                </ng-container>


                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="feedback">
                                    <th mat-header-cell *matHeaderCellDef> Feedback </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.feedback | titlecase}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="action">
                                    <th mat-header-cell *matHeaderCellDef> Action </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button color="primary">
                                            <span (click)="clicktocall(row.AgentID,row.callernumber)" title="Call">
                                                <mat-icon>call</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="incomingfeedbackdialog(row.id)" title="Feedback Edit">
                                                <mat-icon>feedback</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contactdialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>contact_mail</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contacthistorydialog(row.id,row.callernumber)" title="History">
                                                <mat-icon>history</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="row.whatsup_access==0">
                                            <span (click)="whatsappdialog(row.callernumber,row.id,row.show_no_id)" title="Share Whatsapp">
                                                <i style="font-size: 25px;" class="fab fa-whatsapp"></i>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary"*ngIf="access==1">
                                            <span (click)="openrecording(row.id,row.RecPath)" title="Listen Audio">
                                                <mat-icon>headset</mat-icon>
                                              </span>
                                        </button>
                                    </td>
                                </ng-container>
                            
                                <tr mat-header-row *matHeaderRowDef="missedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: missedColumns;"></tr>
                            </table>
                        </div>
                        <!--Paginations-->
                        <mat-paginator #missedpaginator [length]="missedLength" [pageSize]="50"
                        [pageSizeOptions]="[50,100,500]"></mat-paginator>
                    </mat-tab>
                    <!-- History of Outgoing-->
                    <mat-tab label="Outgoing" >
                        <!--Process Bar-->
                        <mat-progress-bar mode="indeterminate" *ngIf="isLoading1"></mat-progress-bar>
                        <!--History Table-->
                        <div class="table-responsive mt-3">
                            <table mat-table [dataSource]="manualdataSource" matSort class="mat-elevation-z8">
                            
                                <!-- Position Column -->
                                <ng-container matColumnDef="id">
                                    <th mat-header-cell *matHeaderCellDef> Sr. No. </th>
                                    <td mat-cell *matCellDef="let row;let i = index;" data-label="id">
                                        {{i+1+(manualpaginator.pageIndex * manualpaginator.pageSize)}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallStartTime Column -->
                                <ng-container matColumnDef="CallStartTime">
                                    <th mat-header-cell *matHeaderCellDef>  Call Time </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStartTime | date: 'dd-MM-yyyy H:mm:s':timezone}}
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="DID">
                                    <th mat-header-cell *matHeaderCellDef>  DID </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.DID}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerName Column -->
                                <ng-container matColumnDef="CallerName">
                                    <th mat-header-cell *matHeaderCellDef> Name </th>
                                    <td mat-cell *matCellDef="let row"> 
                                        {{row.CallerName}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerNumber Column -->
                                <ng-container matColumnDef="CallerNumber">
                                    <th mat-header-cell *matHeaderCellDef> Number </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallerNumber}}
                                    </td>
                                </ng-container>

                                <!-- CallTalkTime Column -->
                                <ng-container matColumnDef="CallTalkTime">
                                    <th mat-header-cell *matHeaderCellDef> Duration </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallTalkTime}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="CallStatus">
                                    <th mat-header-cell *matHeaderCellDef> Status </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStatus}}
                                    </td>
                                </ng-container>

                                
                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="feedback">
                                    <th mat-header-cell *matHeaderCellDef> Feedback </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.feedback | titlecase}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="action">
                                    <th mat-header-cell *matHeaderCellDef> Action </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button color="primary">
                                            <span (click)="clicktocall(row.AgentID,row.callernumber)" title="Call">
                                                <mat-icon>call</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="manualfeedbackdialog(row.id)" title="Feedback Edit">
                                                <mat-icon>feedback</mat-icon>
                                            </span>
                                        </button>&nbsp;
                                        <button mat-icon-button color="primary">
                                            <span (click)="contactdialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>contact_mail</mat-icon>
                                            </span>
                                        </button>&nbsp;
                                        <button mat-icon-button color="primary">
                                            <span (click)="contacthistorydialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>history</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="row.whatsup_access==0">
                                            <span (click)="whatsappdialog(row.callernumber,row.id,row.show_no_id)" title="Share Whatsapp">
                                                <i style="font-size: 25px;" class="fab fa-whatsapp"></i>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="access==1">
                                            <span (click)="openrecording(row.id,row.RecPath)" title="Listen Audio">
                                                <mat-icon>headset</mat-icon>
                                              </span>
                                        </button>
                                    </td>
                                </ng-container>
                            
                                <tr mat-header-row *matHeaderRowDef="manualColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: manualColumns;"></tr>
                            </table>
                        </div>
                        <mat-paginator #manualpaginator [length]="manualLength" [pageSize]="50"
                        [pageSizeOptions]="[50,100,500]"></mat-paginator>
                    </mat-tab>
                    <!-- History of Incoming-->         
                    <mat-tab label="Incoming">
                        <!--Process Bar-->
                        <mat-progress-bar mode="indeterminate" *ngIf="isLoading2"></mat-progress-bar>
                        <!--History Table-->
                        <div class="table-responsive mt-3">
                            <table mat-table [dataSource]="incomingdataSource" matSort class="mat-elevation-z8">
                            
                                <!-- Position Column -->
                                <ng-container matColumnDef="id">
                                    <th mat-header-cell *matHeaderCellDef> Sr. No. </th>
                                    <td mat-cell *matCellDef="let row;let i = index;" data-label="id">
                                        {{i+1+(incomingpaginator.pageIndex * incomingpaginator.pageSize)}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallStartTime Column -->
                                <ng-container matColumnDef="CallStartTime">
                                    <th mat-header-cell *matHeaderCellDef>  Call Time </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStartTime | date: 'dd-MM-yyyy H:mm:s':timezone}}
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="DID">
                                    <th mat-header-cell *matHeaderCellDef>  DID </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.DID}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerName Column -->
                                <ng-container matColumnDef="CallerName">
                                    <th mat-header-cell *matHeaderCellDef> Name </th>
                                    <td mat-cell *matCellDef="let row"> 
                                        {{row.CallerName}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerNumber Column -->
                                <ng-container matColumnDef="CallerNumber">
                                    <th mat-header-cell *matHeaderCellDef> Number </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallerNumber}}
                                    </td>
                                </ng-container>

                                <!-- CallTalkTime Column -->
                                <ng-container matColumnDef="CallTalkTime">
                                    <th mat-header-cell *matHeaderCellDef> Duration </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallTalkTime}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="CallStatus">
                                    <th mat-header-cell *matHeaderCellDef> Status </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStatus}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="feedback">
                                    <th mat-header-cell *matHeaderCellDef> Feedback </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.feedback | titlecase}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="action">
                                    <th mat-header-cell *matHeaderCellDef> Action </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button color="primary">
                                            <span (click)="clicktocall(row.AgentID,row.callernumber)" title="Call">
                                                <mat-icon>call</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="incomingfeedbackdialog(row.id)" title="Feedback Edit">
                                                <mat-icon>feedback</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contactdialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>contact_mail</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contacthistorydialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>history</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="row.whatsup_access==0">
                                            <span (click)="whatsappdialog(row.callernumber,row.id,row.show_no_id)" title="Share Whatsapp">
                                                <i style="font-size: 25px;" class="fab fa-whatsapp"></i>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="access==1">
                                            <span (click)="openrecording(row.id,row.RecPath)" title="Listen Audio">
                                                <mat-icon>headset</mat-icon>
                                              </span>
                                        </button>
                                    </td>
                                </ng-container>
                            
                                <tr mat-header-row *matHeaderRowDef="incomingColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: incomingColumns;"></tr>
                            </table>
                        </div>
                        <!--Paginations-->
                        <mat-paginator #incomingpaginator [length]="incomingLength" [pageSize]="50"
                        [pageSizeOptions]="[50,100,500]"></mat-paginator>
                    </mat-tab>
                    <!-- History of Dialer-->
                    <mat-tab label="Dialer">
                        <!--Process Bar-->
                        <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
                        <!-- history table-->
                        <div class="table-responsive mt-3">
                            <table mat-table [dataSource]="dialerdataSource" matSort class="mat-elevation-z8">

                                <!--- Note that these columns can be defined in any order.
                                    The actual rendered columns are set as a property on the row definition" -->
                            
                                <!-- Position Column -->
                                <ng-container matColumnDef="id">
                                    <th mat-header-cell *matHeaderCellDef> Sr. No. </th>
                                    <td mat-cell *matCellDef="let row;let i = index;" data-label="id">
                                        {{i+1+(dialerpaginator.pageIndex * dialerpaginator.pageSize)}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallStartTime Column -->
                                <ng-container matColumnDef="CallStartTime">
                                    <th mat-header-cell *matHeaderCellDef>  Call Time </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStartTime | date: 'dd-MM-yyyy H:mm:s':timezone}}
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="DID">
                                    <th mat-header-cell *matHeaderCellDef>  DID </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.DID}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerName Column -->
                                <ng-container matColumnDef="CallerName">
                                    <th mat-header-cell *matHeaderCellDef> Name </th>
                                    <td mat-cell *matCellDef="let row"> 
                                        {{row.CallerName}}
                                    </td>
                                </ng-container>
                            
                                <!-- CallerNumber Column -->
                                <ng-container matColumnDef="CallerNumber">
                                    <th mat-header-cell *matHeaderCellDef> Number </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallerNumber}}
                                    </td>
                                </ng-container>

                                <!-- CallTalkTime Column -->
                                <ng-container matColumnDef="CallTalkTime">
                                    <th mat-header-cell *matHeaderCellDef> Duration </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallTalkTime}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="CallStatus">
                                    <th mat-header-cell *matHeaderCellDef> Status </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.CallStatus}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="feedback">
                                    <th mat-header-cell *matHeaderCellDef> Feedback </th>
                                    <td mat-cell *matCellDef="let row">
                                        {{row.feedback | titlecase}}
                                    </td>
                                </ng-container>

                                <!-- CallStatus Column -->
                                <ng-container matColumnDef="action">
                                    <th mat-header-cell *matHeaderCellDef> Action </th>
                                    <td mat-cell *matCellDef="let row">
                                        <button mat-icon-button color="primary">
                                            <span (click)="clicktocall(row.AgentID,row.callernumber)" title="Call">
                                                <mat-icon>call</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="dialerfeedbackdialog(row.id)" title="Feedback Edit">
                                                <mat-icon>feedback</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contactdialog(row.id,row.callernumber)" title="Generate Contact">
                                                <mat-icon>contact_mail</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary">
                                            <span (click)="contacthistorydialog(row.id,row.callernumber)" title="History">
                                                <mat-icon>history</mat-icon>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="row.whatsup_access==0">
                                            <span (click)="whatsappdialog(row.callernumber,row.id,row.show_no_id)" title="Share Whatsapp">
                                                <i style="font-size: 25px;" class="fab fa-whatsapp"></i>
                                            </span>
                                        </button>
                                        <button mat-icon-button color="primary" *ngIf="access==1">
                                            <span (click)="openrecording(row.id,row.RecPath)" title="Listen Audio">
                                                <mat-icon>headset</mat-icon>
                                              </span>
                                        </button>
                                    </td>
                                </ng-container>
                            
                                <tr mat-header-row *matHeaderRowDef="dialerColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: dialerColumns;"></tr>
                            </table>
                        </div>
                        <!--Paginations-->
                        <mat-paginator #dialerpaginator [length]="dialerLength" [pageSize]="50"
                        [pageSizeOptions]="[50,100,500]"></mat-paginator> 
                    </mat-tab>
                    
                </mat-tab-group>  
            </div>
        </div>

    </div>
    <!-- /.container-fluid -->
</div>